<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Healing Root Agro Social App</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    nav { background: #2e7d32; color: white; padding: 10px; display: flex; gap: 10px; }
    nav button { background: white; color: #2e7d32; border: none; padding: 5px 10px; cursor: pointer; border-radius: 5px; }
    .view { display: none; padding: 15px; }
    .card { background: white; padding: 10px; margin-bottom: 15px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
    .card img { max-width: 100%; border-radius: 5px; }
    .muted { color: gray; }
    .btn { background: #2e7d32; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 5px; margin-top: 5px; }
    .small { padding: 3px 6px; font-size: 12px; }
    #chat-window { display: none; position: fixed; bottom: 0; right: 0; width: 300px; background: white; border: 1px solid #ccc; border-radius: 5px 5px 0 0; }
    #chat-window h4 { margin: 0; padding: 5px; background: #2e7d32; color: white; border-radius: 5px 5px 0 0; }
    #messages { max-height: 200px; overflow-y: auto; padding: 5px; }
    input, textarea { width: 100%; padding: 5px; margin-top: 5px; border-radius: 3px; border: 1px solid #ccc; }
  </style>
</head>
<body>

  <nav>
    <button id="nav-feed">Feed</button>
    <button id="nav-products">Products</button>
    <button id="nav-profile">Profile</button>
    <button id="nav-notifications">Notifications</button>
    <button id="logout-btn">Logout</button>
  </nav>

  <!-- FEED VIEW -->
  <div id="feed-view" class="view">
    <h2>Feed</h2>
    <div id="feed"></div>
  </div>

  <!-- PRODUCTS VIEW -->
  <div id="products-view" class="view">
    <h2>Products</h2>
    <div id="product-list"></div>
  </div>

  <!-- PROFILE VIEW -->
  <div id="profile-view" class="view">
    <h2>Profile</h2>
    <img id="profile-pic" src="images/default_profile.png" alt="Profile" width="100">
    <input type="file" id="profile-upload">
    <input type="text" id="bio" placeholder="Write your bio...">
    <h3>Friends</h3>
    <div id="friends"></div>
  </div>

  <!-- NOTIFICATIONS VIEW -->
  <div id="notifications-view" class="view">
    <h2>Notifications</h2>
    <div id="notifications"></div>
  </div>

  <!-- CHAT WINDOW -->
  <div id="chat-window">
    <h4 id="chat-with">Chat</h4>
    <div id="messages"></div>
    <input type="text" id="chat-input" placeholder="Type a message...">
    <button id="send-chat" class="btn">Send</button>
  </div>

  <!-- AUTH FORMS (hidden initially, can be modal if you want) -->
  <div id="auth-forms" class="view">
    <h2>Sign Up</h2>
    <form id="signup-form">
      <input type="text" id="signup-name" placeholder="Name" required>
      <input type="email" id="signup-email" placeholder="Email" required>
      <input type="password" id="signup-password" placeholder="Password" required>
      <button class="btn">Sign Up</button>
    </form>

    <h2>Login</h2>
    <form id="login-form">
      <input type="email" id="login-email" placeholder="Email" required>
      <input type="password" id="login-password" placeholder="Password" required>
      <button class="btn">Login</button>
    </form>
  </div>

  <script type="module" src="app.js"></script>
  <script>
    // PROFILE UPLOAD HANDLER (Cloudinary)
    const profileUpload = document.getElementById('profile-upload');
    profileUpload?.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', 'unsigned_upload');

      const res = await fetch('https://api.cloudinary.com/v1_1/dd7dre9hd/upload', {
        method: 'POST',
        body: formData
      });
      const data = await res.json();
      const url = data.secure_url;
      document.getElementById('profile-pic').src = url;

      if (window.currentUser) {
        await setDoc(doc(window.db, 'users', window.currentUser.uid), { profilePic: url }, { merge: true });
      }
    });
  </script>
</body>
</html>
